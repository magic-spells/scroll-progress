!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ScrollProgress={})}(this,function(t){"use strict";class ScrollProgress extends HTMLElement{#t=null;#e=0;#s=null;#i=null;#r=!1;#o=null;#n=null;#c=-1;static#h=!1;static#a(){if(ScrollProgress.#h)return;const t=document.createElement("style");t.textContent="scroll-progress {\n\tdisplay: block;\n\t--scroll-progress: 0;\n\twill-change: transform;\n\ttransform-style: preserve-3d;\n\tbackface-visibility: hidden; }",document.head.appendChild(t),ScrollProgress.#h=!0}static get observedAttributes(){return["playhead-element-start","playhead-viewport-start","playhead-element-end","playhead-viewport-end"]}constructor(){super(),ScrollProgress.#a()}connectedCallback(){this.#e=window.innerHeight,this.#l(),this.#d(),this.#p(),this.#g()}disconnectedCallback(){this.#u(),this.#v(),this.#w()}attributeChangedCallback(t,e,s){e!==s&&this.#t&&this.#l()}#l(){const t=this.getBoundingClientRect();this.#t={elementStartAnchor:this.getAttribute("playhead-element-start")||"top",viewportStartAnchor:this.getAttribute("playhead-viewport-start")||"bottom",elementEndAnchor:this.getAttribute("playhead-element-end")||"bottom",viewportEndAnchor:this.getAttribute("playhead-viewport-end")||"top",elementStartPosition:0,elementEndPosition:0,viewportStartPosition:0,viewportEndPosition:0,totalDistance:0},this.#P(t)}#P(t){t||(t=this.getBoundingClientRect()),this.#t&&(this.#t.elementStartPosition=this.#m(this.#t.elementStartAnchor,t),this.#t.elementEndPosition=this.#m(this.#t.elementEndAnchor,t),this.#t.viewportStartPosition=this.#b(this.#t.viewportStartAnchor,this.#e),this.#t.viewportEndPosition=this.#b(this.#t.viewportEndAnchor,this.#e),this.#t.totalDistance=this.#t.elementEndPosition-this.#t.viewportEndPosition-(this.#t.elementStartPosition-this.#t.viewportStartPosition),this.#t.totalDistance<0&&(console.warn("<scroll-progress> totalDistance negative, check anchors"),this.#t.totalDistance=Math.abs(this.#t.totalDistance)))}#m(t,e){return"top"===t?e.top:"center"===t?e.top+e.height/2:e.bottom}#b(t,e){return"top"===t?0:"center"===t?e/2:e}#f(t,e,s){return t<e?e:t>s?s:t}#g(){const t=()=>{this.#r&&this.#A(),this.#o=requestAnimationFrame(t)};this.#o=requestAnimationFrame(t)}#u(){this.#o&&(cancelAnimationFrame(this.#o),this.#o=null)}#A(){if(!this.#t)return;const t=this.getBoundingClientRect(),e=this.#m(this.#t.elementStartAnchor,t),s=this.#t.viewportStartPosition-e,i=0===this.#t.totalDistance?0:this.#f(s/this.#t.totalDistance,0,1);Math.abs(i-this.#c)>.001&&(this.#c=i,this.style.setProperty("--scroll-progress",i),this.dispatchEvent(new CustomEvent("scroll-progress:update",{detail:{progress:i},bubbles:!0})))}#d(){if("ResizeObserver"in window&&(this.#s=new ResizeObserver(t=>{t.forEach(t=>{t.target===this&&this.#P(t.contentRect)})}),this.#s.observe(this)),"IntersectionObserver"in window){const t={rootMargin:"50% 0px 50% 0px"};this.#i=new IntersectionObserver(t=>{t.forEach(t=>{t.target===this&&(this.#r=t.isIntersecting)})},t),this.#i.observe(this)}else this.#r=!0}#w(){this.#s&&(this.#s.disconnect(),this.#s=null),this.#i&&(this.#i.disconnect(),this.#i=null)}#p(){this.#n=function(t,e){let s=0;return function(...i){const r=Date.now();r-s>=e&&(s=r,t.apply(this,i))}}(()=>{this.#e=window.innerHeight,this.#t&&(this.#t.viewportStartPosition=this.#b(this.#t.viewportStartAnchor,this.#e),this.#t.viewportEndPosition=this.#b(this.#t.viewportEndAnchor,this.#e),this.#t.totalDistance=this.#t.elementEndPosition-this.#t.viewportEndPosition-(this.#t.elementStartPosition-this.#t.viewportStartPosition),this.#P())},50),window.addEventListener("resize",this.#n)}#v(){this.#n&&(window.removeEventListener("resize",this.#n),this.#n=null)}getProgress(){return parseFloat(this.style.getPropertyValue("--scroll-progress")||0)}update(){this.#t&&this.#P()}pause(){this.#u()}resume(){this.#o||this.#g()}}customElements.get("scroll-progress")||customElements.define("scroll-progress",ScrollProgress),t.ScrollProgress=ScrollProgress});
